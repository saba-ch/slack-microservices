steps:
  - timeout: 600s
  - name: gcr.io/cloud-builders/docker
    args: [
      'build',
      '-f',
      './channel/Dockerfile',
      '-t',
      'gcr.io/slack-channel/slack-channel-dev:$BUILD_ID',
      '.'
    ]
  - name: gcr.io/cloud-builders/docker
    args: [
      'push',
      'gcr.io/slack-channel/slack-channel-dev:$BUILD_ID'
    ]
  - name: gcr.io/cloud-builders/kubectl
    args: [
      'set',
      'image',
      'deployment/channel-depl',
      'd3bug3r/slack-channel=gcr.io/slack-channel/slack-channel-dev:$BUILD_ID',
    ]
  - name: 'gcr.io/cloud-builders/kubectl'
    id: Deploy
    args: [
      'apply',
      '-f',
      'infra/k8s/channel-depl.yaml'
    ]
    env:
      - 'CLOUDSDK_COMPUTE_ZONE=us-central1-c'
      - 'CLOUDSDK_CONTAINER_CLUSTER=slack'